return {
  {
    "itchyny/lightline.vim",
    lazy = false,
    dependencies = {
      "itchyny/vim-gitbranch",
      "josa42/nvim-lightline-lsp",
      "mengelbrecht/lightline-bufferline",
    },
    init = function()
      vim.cmd([[
        function! GetGitBranch() abort
          if gitbranch#name() != ''
            return ' ' . gitbranch#name()
          else
            return ''
          endif
        endfunction
      ]])

      vim.g.lightline = {
        colorscheme = "tokyonight",
        separator = { left = "", right = "" },
        subseparator = { left = "", right = "" },
        active = {
          left = {
            { "mode", "paste" },
            { "gitbranch", "filename", "modified", "readonly" },
          },
          right = {
            { "lsp_errors", "lsp_warnings", "lsp_info", "lsp_hints" },
            { "lineinfo", "percent" },
            { "fileformat", "fileencoding", "filetype" },
          },
        },
        component_function = {
          gitbranch = "GetGitBranch",
        },
        tabline = {
          left = { { "buffers" } },
          right = { {} },
        },
        component_expand = {
          buffers = "lightline#bufferline#buffers",
        },
        component_type = {
          buffers = "tabsel",
        },
      }

      vim.g['lightline#bufferline#show_number'] = 2
      vim.g['lightline#bufferline#enable_devicons'] = 0
      vim.g['lightline#bufferline#unnamed'] = '[No Name]'
      vim.g['lightline#bufferline#icon_position'] = 'right'

      vim.g['lightline#lsp#indicator_errors']   = 'E:'
      vim.g['lightline#lsp#indicator_warnings'] = 'W:'
      vim.g['lightline#lsp#indicator_info']     = 'I:'
      vim.g['lightline#lsp#indicator_hints']    = 'H:'

    end,
    config = function()
      vim.fn['lightline#lsp#register']()
      local lightline_augroup = vim.api.nvim_create_augroup('LightlineUpdate', { clear = true })
      vim.api.nvim_create_autocmd('DiagnosticChanged', {
        group = lightline_augroup,
        pattern = '*',
        callback = function()
          vim.fn['lightline#update']()
        end,
      })
    end,
  },
}
