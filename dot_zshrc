# --- 1. 外部設定の読み込み ---
[[ -f ~/.profile ]] && source ~/.profile
[[ -f ~/.aliases ]] && source ~/.aliases

# --- 2. zsh挙動設定 (setopt) ---
setopt autocd              # ディレクトリ名のみでcd
setopt correct             # スペルミス修正
setopt extendedglob        # 拡張グロブ有効
setopt nocaseglob          # グロブで大文字小文字を区別しない
setopt numericglobsort     # 数字を数値順にソート
setopt nobeep              # ビープ音無効
setopt appendhistory       # 履歴を上書きせず追記
setopt histignorealldups   # 重複履歴を削除
setopt inc_append_history  # 即座に履歴を保存
HISTFILE=~/.zhistory
HISTSIZE=10000
SAVEHIST=10000

# --- 3. 補完設定 (zstyle) ---
autoload -Uz compinit && compinit
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"
zstyle ':completion:*' use-cache on
zstyle ':completion:*' cache-path ~/.zsh/cache

# --- 4. プラグイン管理 ---
eval "$(sheldon source)"
eval "$(zoxide init zsh --cmd cd)"
eval "$(starship init zsh)"

# --- 5. キーバインド設定 ---
bindkey -e
# Substring Searchの設定
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down
# 汎用的なHome/Endキー設定
bindkey "${terminfo[khome]}" beginning-of-line
bindkey "${terminfo[kend]}" end-of-line
# 単語間の移動
bindkey "^[[1;5C" forward-word
bindkey "^[[1;5D" backward-word
bindkey '^[[7~' beginning-of-line
bindkey '^[[H' beginning-of-line
bindkey '^[[8~' end-of-line
bindkey '^[[F' end-of-line
bindkey '^[[3~' delete-char

# --- 6. Tmux 自動起動ロジック ---
if [[ -z $TMUX ]]; then
  ID="$(tmux list-sessions 2>/dev/null)"
  if [[ -z "$ID" ]]; then
    tmux new-session
  else
    create_new_session="Create New Session"
    ID="$(echo -e "$ID\n${create_new_session}:" | fzf | cut -d: -f1)"
    if [[ "$ID" = "${create_new_session}" ]]; then
      tmux new-session
    elif [[ -n "$ID" ]]; then
      tmux attach-session -t "$ID"
    fi
  fi
fi

# Dart補完
[[ -f /home/hyuoou/.config/.dart-cli-completion/zsh-config.zsh ]] && . /home/hyuoou/.config/.dart-cli-completion/zsh-config.zsh

# ハイライトを設定
typeset -A ZSH_HIGHLIGHT_STYLES
ZSH_HIGHLIGHT_STYLES[suffix-alias]=fg=blue,underline
ZSH_HIGHLIGHT_STYLES[precommand]=fg=blue,underline
ZSH_HIGHLIGHT_STYLES[arg0]=fg=blue
ZSH_HIGHLIGHT_STYLES[path]=fg=cyan
